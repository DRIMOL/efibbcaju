server {
    listen 443 ssl;
    server_name webhook.yourdomain.com;  # Replace with your actual domain

    # SSL certificate configuration
    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;
    
    # EFI Bank certificate for mTLS
    ssl_client_certificate /path/to/efi/certificate-chain-prod.crt;
    ssl_verify_client optional;
    ssl_verify_depth 3;

    # Log configuration
    access_log /var/log/nginx/webhook_access.log;
    error_log /var/log/nginx/webhook_error.log;

    # Webhook endpoint
    location /webhook {
        # Check if the client certificate is valid
        if ($ssl_client_verify != SUCCESS) {
            return 403;
        }

        # Pass the mTLS verification status to PHP
        proxy_set_header X-Client-Verified $ssl_client_verify;
        
        # Pass the request to PHP-FPM
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /path/to/www/webhook.php;
        fastcgi_pass unix:/var/run/php/php-fpm.sock;  # Adjust based on your PHP-FPM configuration
    }
}
